## v3.3 Sweep Playbook

Operator guide for v3.3 sweeps and baseline data collection. Stack A = TRT-LLM UMA-only; Stack B = Dynamo + tiered KV. Profiles via `scripts/stackB_tier_env.py`; LoRA adapter churn via `scripts/adapter_proxy.py`.

### Recommended Sweep Order
- **Phase A – Baselines:** H0 (Stack A/B, Comfy) via `runs/run_H0_queue_knee.sh`; H2A (Stack A, Comfy) via `runs/run_H2A_uma_pressure.sh`; H2B (Stack B, Spill) via `runs/run_H2B_dynamo_kv_pressure.sh`; H4A (Stack A, Comfy) via `runs/run_H4A_storage_qos.sh`; H4B (Stack B, Spill) via `runs/run_H4B_dynamo_storage_qos.sh`.
- **Phase B – Feature tests:** H1 (Stack B, Spill, LoRA churn) via `runs/run_H1_lora_thrash.sh` with `scripts/adapter_proxy.py` endpoint; H5 (Stack B, Spill, mixed context) via `runs/run_H5_kv_workingset_scaling.sh`; H3 (Stack A/B, Stress profiles) via `runs/run_H3_context_envelope.sh`; H6/H7 (Stack B, Spill for sizing, Stress for telemetry sweep) via `runs/run_H6_tier_sizing_policy.sh` and `runs/run_H7_kv_telemetry_sweep.sh`.
- **Phase C – Hero:** H8 (Stack A/B, Spill mixed-context) via `runs/run_H8_hero_scenario.sh`; align UMA budgets and endpoints for A/B.
- **H9 – Blocked check:** Run once via `runs/run_H9_rehydration.sh` (Stack B, Stress). Expect frontend `session_id` handling to block full validation; mark as “blocked by frontend session_id behavior” after confirming harness side is healthy.

### Post-Run Checks (minimum)
1. Verify `results/<run_id>/` directory exists after the run.
2. Confirm presence of `results/<run_id>/metrics.jsonl`, `results/<run_id>/sysmon.jsonl`, and `results/<run_id>/dynkv.jsonl`.
3. Run `python3 analysis/process_results.py` from repo root.
4. Validate outputs:
   - `analysis/figures/summary_v3.csv` updated.
   - Relevant per-hypothesis CSVs (e.g., `analysis/figures/H4B_p99_vs_nvme.csv`) exist.
   - No stack traces or parsing errors in the script output.

### Baseline Run Recipes (to be filled after first sweep)

#### H0 – Baseline Recipe (to fill in after sweep)
- Stack: A/B
- Profile: Comfy
- Model: nvidia/Llama-3.3-70B-Instruct-NVFP4
- Endpoint: http://127.0.0.1:{8355|9000}/v1/completions
- Runner: ./runs/run_H0_queue_knee.sh
- Env/flags:
  - STACK={stackA|stackB}
  - PROFILE=comfy
  - CONCURRENCY=?
  - CONTEXT_TOKENS=?
  - DURATION_S=?
- Notes:
  - Expected: Queue knee point for baseline transparency checks.

#### H1 – Baseline Recipe (to fill in after sweep)
- Stack: B
- Profile: Spill
- Model: nvidia/Llama-3.3-70B-Instruct-NVFP4
- Endpoint: http://127.0.0.1:9000/v1/completions (via adapter proxy)
- Runner: ./runs/run_H1_lora_thrash.sh
- Env/flags:
  - PROFILE=spill
  - CONCURRENCY=?
  - CONTEXT_TOKENS=4096
  - DURATION_S=?
  - ADAPTER_PROXY=http://127.0.0.1:9100 (if using scripts/adapter_proxy.py)
- Notes:
  - Expected: Tier2-backed adapter churn with nonce_per_user enabled.

#### H2A – Baseline Recipe (to fill in after sweep)
- Stack: A
- Profile: Comfy
- Model: nvidia/Llama-3.3-70B-Instruct-NVFP4
- Endpoint: http://127.0.0.1:8355/v1/completions
- Runner: ./runs/run_H2A_uma_pressure.sh
- Env/flags:
  - PROFILE=comfy
  - CONCURRENCY=?
  - CONTEXT_TOKENS={1024|2048|4096}
  - DURATION_S=?
- Notes:
  - Expected: UMA-only control for KV pressure comparison with H2B.

#### H2B – Baseline Recipe (to fill in after sweep)
- Stack: B
- Profile: Spill
- Model: nvidia/Llama-3.3-70B-Instruct-NVFP4
- Endpoint: http://127.0.0.1:9000/v1/completions
- Runner: ./runs/run_H2B_dynamo_kv_pressure.sh
- Env/flags:
  - PROFILE=spill
  - CONCURRENCY=?
  - CONTEXT_TOKENS={1024|2048|4096}
  - DURATION_S=?
- Notes:
  - Expected: Increased Tier2 traffic and gradual latency degradation vs H2A.

#### H3 – Baseline Recipe (to fill in after sweep)
- Stack: A/B
- Profile: Stress (default for envelope)
- Model: nvidia/Llama-3.3-70B-Instruct-NVFP4
- Endpoint: http://127.0.0.1:{8355|9000}/v1/completions
- Runner: ./runs/run_H3_context_envelope.sh
- Env/flags:
  - PROFILE_STACKA=stress
  - PROFILE_STACKB=stress
  - CONCURRENCY=?
  - DURATION_S=?
- Notes:
  - Expected: Identify context collapse/limit for each stack.

#### H4A – Baseline Recipe (to fill in after sweep)
- Stack: A
- Profile: Comfy
- Model: nvidia/Llama-3.3-70B-Instruct-NVFP4
- Endpoint: http://127.0.0.1:8355/v1/completions
- Runner: ./runs/run_H4A_storage_qos.sh
- Env/flags:
  - PROFILE=comfy
  - CONCURRENCY=32
  - CONTEXT_TOKENS=2048
  - DURATION_S=?
- Notes:
  - Expected: Control for storage QoS sensitivity.

#### H4B – Baseline Recipe (to fill in after sweep)
- Stack: B
- Profile: Spill
- Model: nvidia/Llama-3.3-70B-Instruct-NVFP4
- Endpoint: http://127.0.0.1:9000/v1/completions
- Runner: ./runs/run_H4B_dynamo_storage_qos.sh
- Env/flags:
  - PROFILE=spill
  - CONCURRENCY=32
  - CONTEXT_TOKENS={2048|4096}
  - DURATION_S=?
- Notes:
  - Expected: NVMe QoS impact under tiered KV.

#### H5 – Baseline Recipe (to fill in after sweep)
- Stack: B
- Profile: Spill
- Model: nvidia/Llama-3.3-70B-Instruct-NVFP4
- Endpoint: http://127.0.0.1:9000/v1/completions
- Runner: ./runs/run_H5_kv_workingset_scaling.sh
- Env/flags:
  - PROFILE=spill
  - WORKLOAD=mixed_context
  - CONCURRENCY=?
  - DURATION_S=?
- Notes:
  - Expected: Tier2 churn scaling with adapter set size.

#### H6 – Baseline Recipe (to fill in after sweep)
- Stack: B
- Profile: Spill
- Model: nvidia/Llama-3.3-70B-Instruct-NVFP4
- Endpoint: http://127.0.0.1:9000/v1/completions
- Runner: ./runs/run_H6_tier_sizing_policy.sh
- Env/flags:
  - PROFILE=spill
  - CONCURRENCY=32
  - CONTEXT_TOKENS=1024
  - DURATION_S=?
- Notes:
  - Expected: Eviction policy stress and tier sizing guidance.

#### H7 – Baseline Recipe (to fill in after sweep)
- Stack: B
- Profile: Stress
- Model: nvidia/Llama-3.3-70B-Instruct-NVFP4
- Endpoint: http://127.0.0.1:9000/v1/completions
- Runner: ./runs/run_H7_kv_telemetry_sweep.sh
- Env/flags:
  - PROFILE=stress
  - CONCURRENCY=32
  - CONTEXT_TOKENS=1024
  - DURATION_S=?
- Notes:
  - Expected: Telemetry cadence vs tier2 fetch pressure.

#### H8 – Baseline Recipe (to fill in after sweep)
- Stack: A/B
- Profile: Spill
- Model: nvidia/Llama-3.3-70B-Instruct-NVFP4
- Endpoint: http://127.0.0.1:{8355|9000}/v1/completions
- Runner: ./runs/run_H8_hero_scenario.sh
- Env/flags:
  - PROFILE_STACKA=spill
  - PROFILE_STACKB=spill
  - CONCURRENCY=?
  - DURATION_S=?
- Notes:
  - Expected: Hero side-by-side at aligned UMA budgets.

#### H9 – Baseline Recipe (to fill in after sweep)
- Stack: B
- Profile: Stress
- Model: nvidia/Llama-3.3-70B-Instruct-NVFP4
- Endpoint: http://127.0.0.1:9000/v1/completions
- Runner: ./runs/run_H9_rehydration.sh
- Env/flags:
  - PROFILE=stress
  - CONCURRENCY=8
  - CONTEXT_TOKENS=4096
  - DURATION_BUILD=?
  - DURATION_RESUME=?
- Notes:
  - Expected: Rehydration path likely blocked by frontend session_id behavior; run once to confirm.
